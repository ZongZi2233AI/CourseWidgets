# Windows 端测试指南 v2.2.0

## 🎯 测试重点

### 1. 课程渲染测试 ⭐⭐⭐
**问题**: 课程显示为白条

**测试步骤**:
1. 打开应用
2. 导航到"课程"页面
3. 检查课程卡片是否正常显示
4. 检查课程名称是否可见
5. 检查课程地点是否可见（高度足够时）
6. 点击课程卡片，检查详情对话框

**预期结果**:
- ✅ 课程卡片显示为渐变色（柔珊瑚色）
- ✅ 课程名称清晰可见（白色粗体）
- ✅ 课程地点清晰可见（白色半透明）
- ✅ 卡片有阴影效果
- ✅ 鼠标悬停时有视觉反馈
- ❌ 不应该显示为白条或灰条

**如果仍然是白条**:
- 检查控制台输出是否有渲染错误
- 尝试调整窗口大小
- 尝试切换周次

---

### 2. 托盘功能测试 ⭐⭐⭐
**问题**: 托盘图标不显示

**测试步骤**:
1. 打开应用
2. 检查 Windows 任务栏右下角托盘区域
3. 查找 CourseWidgets 图标
4. 左键点击托盘图标
5. 右键点击托盘图标
6. 点击"显示窗口"菜单项
7. 点击"退出"菜单项

**预期结果**:
- ✅ 托盘区域显示应用图标
- ✅ 左键点击显示/隐藏窗口
- ✅ 右键点击显示菜单
- ✅ "显示窗口"菜单项正常工作
- ✅ "退出"菜单项正常工作

**如果托盘不显示**:
1. 检查控制台输出:
   ```
   ✅ 托盘初始化成功
   ✅ 托盘菜单设置成功
   ✅ Windows托盘初始化完成
   ```

2. 如果看到错误:
   ```
   ❌ 初始化Windows托盘失败: ...
   ```
   - 检查图标文件是否存在
   - 检查图标路径是否正确

3. 检查图标文件:
   ```powershell
   # 在应用目录下检查
   dir data\flutter_assets\assets\app_icon.ico
   ```

4. 如果图标文件不存在:
   - 重新运行 `python generate_windows_icon.py`
   - 重新构建应用

---

### 3. 窗口动画测试 ⭐⭐
**问题**: 最大化/还原没有动画

**测试步骤**:
1. 打开应用
2. 点击最大化按钮
3. 观察窗口是否有动画效果
4. 点击还原按钮
5. 观察窗口是否有动画效果
6. 双击标题栏最大化/还原

**预期结果**:
- ✅ 窗口最大化时有平滑动画
- ✅ 窗口还原时有平滑动画
- ✅ 窗口圆角根据状态调整（最大化时无圆角）

**说明**:
- Windows 窗口动画由系统控制
- 如果系统禁用了动画，应用也不会有动画
- 检查 Windows 设置 → 系统 → 显示 → 高级显示设置 → 性能选项 → 视觉效果

**如果没有动画**:
1. 检查 Windows 系统设置:
   - 设置 → 轻松使用 → 显示 → 在 Windows 中显示动画
   - 确保已启用

2. 检查性能选项:
   - 控制面板 → 系统 → 高级系统设置 → 性能 → 设置
   - 确保"窗口内的动画控件和元素"已勾选

---

### 4. DPI 缩放测试 ✅
**状态**: 已修复

**测试步骤**:
1. 在不同 DPI 设置下启动应用
2. 检查窗口大小是否正确
3. 检查内容是否被压缩
4. 检查点击位置是否准确

**测试 DPI 设置**:
- 100% (推荐)
- 125%
- 150%
- 175%
- 200%

---

### 5. 窗口调整大小测试 ✅
**状态**: 已修复

**测试步骤**:
1. 拖拽窗口右边缘调整宽度
2. 拖拽窗口下边缘调整高度
3. 拖拽窗口右下角调整大小
4. 尝试缩小到最小尺寸
5. 检查内容是否正确缩放

**预期结果**:
- ✅ 窗口可以调整大小
- ✅ 最小尺寸为 800x600
- ✅ 内容正确缩放

---

### 6. 应用图标测试 ✅
**状态**: 已修复

**测试步骤**:
1. 检查任务栏图标
2. 检查窗口标题栏图标
3. 检查 Alt+Tab 切换时的图标
4. 检查开始菜单图标（如果固定）

**预期结果**:
- ✅ 所有位置显示应用图标

---

## 🔍 调试方法

### 查看控制台输出

运行应用时，检查控制台输出：

```powershell
# 在应用目录下运行
.\build\windows\x64\runner\Release\CourseWidgets.exe
```

**关键日志**:

1. **窗口初始化**:
   ```
   ✅ 窗口初始化完成: 1024x768, 可调整大小, 启用动画
   ```

2. **托盘初始化**:
   ```
   尝试初始化托盘，图标路径: data/flutter_assets/assets/app_icon.ico
   ✅ 托盘初始化成功
   ✅ 托盘菜单设置成功
   ✅ Windows托盘初始化完成
   ```

3. **托盘事件**:
   ```
   📌 托盘事件: leftMouseDown
   左键点击托盘
   ```

### 检查图标文件

```powershell
# 检查图标是否存在
dir .\build\windows\x64\runner\Release\data\flutter_assets\assets\app_icon.ico

# 如果不存在，检查其他位置
dir .\build\windows\x64\runner\Release\*.ico /s
```

### 重新生成图标

如果图标有问题：

```powershell
# 重新生成图标
python generate_windows_icon.py

# 重新构建
flutter build windows --release
```

---

## 🐛 已知问题和解决方案

### 问题 1: 课程显示为白条

**原因**: Skia 渲染问题

**解决方案**: 已使用 Material + InkWell + Ink 替代

**验证**: 检查课程卡片是否显示渐变色和阴影

---

### 问题 2: 托盘图标不显示

**原因**: 图标路径不正确或图标文件不存在

**解决方案**: 
1. 检查控制台输出
2. 验证图标文件存在
3. 重新生成图标

**验证**: 检查托盘区域是否有图标

---

### 问题 3: 窗口动画不流畅

**原因**: Windows 系统动画设置

**解决方案**: 
1. 启用 Windows 动画
2. 检查性能选项

**验证**: 最大化/还原窗口时观察动画

---

## 📊 测试报告模板

```markdown
## Windows 端测试报告

**测试日期**: 2025-01-24
**版本**: 2.2.0 (10002200)
**测试环境**: 
- Windows 版本: 
- DPI 设置: 
- 屏幕分辨率: 

### 测试结果

#### 1. 课程渲染
- [ ] 课程卡片正常显示
- [ ] 课程名称可见
- [ ] 课程地点可见
- [ ] 无白条/灰条问题
- [ ] 点击响应正常

**问题**: 

**截图**: 

---

#### 2. 托盘功能
- [ ] 托盘图标显示
- [ ] 左键点击正常
- [ ] 右键菜单显示
- [ ] 菜单项正常工作

**问题**: 

**截图**: 

---

#### 3. 窗口动画
- [ ] 最大化有动画
- [ ] 还原有动画
- [ ] 圆角正确调整

**问题**: 

**截图**: 

---

#### 4. DPI 缩放
- [ ] 100% DPI 正常
- [ ] 125% DPI 正常
- [ ] 150% DPI 正常
- [ ] 内容无压缩

**问题**: 

---

#### 5. 窗口调整
- [ ] 可以调整大小
- [ ] 最小尺寸限制正常
- [ ] 内容正确缩放

**问题**: 

---

#### 6. 应用图标
- [ ] 任务栏图标显示
- [ ] 标题栏图标显示
- [ ] Alt+Tab 图标显示

**问题**: 

---

### 总体评价

- [ ] 所有功能正常
- [ ] 部分功能有问题
- [ ] 需要进一步修复

**备注**: 
```

---

## 🎯 下一步

1. **运行应用**: `.\build\windows\x64\runner\Release\CourseWidgets.exe`
2. **检查控制台**: 查看初始化日志
3. **测试功能**: 按照测试清单逐项测试
4. **报告问题**: 如果有问题，提供详细信息

---

**祝测试顺利！** 🚀
